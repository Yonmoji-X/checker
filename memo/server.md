ã€AWS LightSail Laravelãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã€‘

â– æ¦‚è¦
ãƒ»chackerï¼ˆLaravelï¼‰ã‚’AWS LightSailã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚
ãƒ».envãƒ•ã‚¡ã‚¤ãƒ«ã¯ä½œã‚‰ãšã€ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒå¤‰æ•°ã«é‡é‡æƒ…å ±ã‚’ä¿æŒã™ã‚‹ã€‚ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é¢è€ƒæ…®ï¼‰
ãƒ»Stripeï¼ˆã‚µãƒ–ã‚¹ã‚¯ï¼‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã‚’æº€ãŸã™ã‚ˆã†è¨­è¨ˆã™ã‚‹ã€‚
ãƒ»LightSailãƒ‡ãƒ—ãƒ­ã‚¤ã«å‘ã‘ãŸchackerã®èª¿æ•´ã‚’è¡Œã†ã€‚
	ãƒ»ãƒ­ã‚°ã‚¤ãƒ³sessionã®å•é¡Œè§£æ±ºï¼ˆ404ã‚¨ãƒ©ãƒ¼ï¼‰
	ãƒ».envã¸ã®pathã®èª¿æ•´ã€‚
	ãƒ»JSã”ã‚ŠæŠ¼ã—ã®ã‚³ãƒ¼ãƒ‰ã‚’laravelã«æ›¸ãæ›ãˆã‚‹ã€‚ï¼ˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§å–å¾—ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼‰
	ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã€DBã¯åˆ¥ã«ç”¨æ„ã™ã‚‹
	ã€€Laravelã‚¢ãƒ—ãƒªç”¨Lightsailã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ 
	ã€€ï¼‹ å¤–éƒ¨DBï¼ˆLightsail Managed DBã¾ãŸã¯RDSï¼‰



â– æ‰‹é †
â‘ stripeã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ã‚’æº€ãŸã™ã‚ˆã†ã«ã€ä¸‹è¨˜ã•ã‚“ç‚¹ã‚’åŒæ™‚ä¸¦è¡Œã§èª¿æ•´ã™ã‚‹ã€‚
	ãƒ»chackerã®èª¿æ•´
	ãƒ»AWS lightsailç™»éŒ²ã€ç’°å¢ƒä½œæˆ
	ãƒ»awsã¨åŒæ™‚ä¸¦è¡Œã§Stripeã®æº–å‚™
	ãƒ»DBã¯LightSailã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨åˆ¥ã«ç”¨æ„ã™ã‚‹ã€‚ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„è¦³ç‚¹ï¼‰
	

â‘¡ãƒ—ãƒ©ãƒ³ã®èª¿æ•´
	ãƒ»Stripe


â– å‚è€ƒè³‡æ–™
ãƒ»AWS LightSailã¸ã®Laravelã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
	https://qiita.com/nozhy/items/a970a843121e9d9b1b44

ãƒ»AWS LightSailã¸ã®Laravelã‚¢ãƒ—ãƒªãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †2
	https://zenn.dev/oyatsu_karpas/articles/9536427de600d1

ãƒ»GitHubã‹ã‚‰AWS Lightsailã¸Laravel 11ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ–¹æ³•ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºæœ‰ï¼‰
	https://biz.addisteria.com/laravel_aws_lightsail/


äº†è§£ã§ã™ï¼ã§ã¯ä»Šæ—¥ã‚„ã£ãŸä½œæ¥­ã‚’æ•´ç†ã—ã¦ã€**Bitnami Lightsail ä¸Šã® Laravel ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«**ã¨ã—ã¦ã¾ã¨ã‚ã¾ã™ã€‚â­å°ã¯æ³¨æ„ãƒã‚¤ãƒ³ãƒˆã‚„ã‚³ãƒ„ã§ã™ã€‚

---

# Bitnami Lightsail + Laravel ãƒ‡ãƒ—ãƒ­ã‚¤ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ï¼ˆç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ + SSLï¼‰

## â‘  Laravel ã® `.env` ã‚’å®‰å…¨ã«é…ç½®ã™ã‚‹æ–¹æ³•

Laravel ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« `.env` ã¯ **çµ¶å¯¾ã«ã‚¦ã‚§ãƒ–å…¬é–‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã«ç½®ã‹ãªã„**ã“ã¨ãŒå®‰å…¨ã§ã™ã€‚

### æ‰‹é †

1. Laravel ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ `/opt/bitnami/apps/laravel/htdocs` ã«é…ç½®

   ```bash
   sudo mkdir -p /opt/bitnami/apps/laravel/htdocs
   sudo chown -R bitnami:daemon /opt/bitnami/apps/laravel/htdocs
   sudo chmod -R 775 /opt/bitnami/apps/laravel/htdocs
   ```

2. `.env` ã‚’ Laravel ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã«ã‚³ãƒ”ãƒ¼

   * â­ **å…¬é–‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `public` ã®å¤–ã«ç½®ãã“ã¨**
   * ä¾‹: `/opt/bitnami/apps/laravel/htdocs/.env`

3. `.env` ã®æ¨©é™ã‚’è¨­å®š

   ```bash
   sudo chown bitnami:daemon /opt/bitnami/apps/laravel/htdocs/.env
   sudo chmod 640 /opt/bitnami/apps/laravel/htdocs/.env
   ```

4. `storage` ã¨ `bootstrap/cache` ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ Apache ç”¨ã«è¨­å®š

   ```bash
   sudo chown -R bitnami:daemon /opt/bitnami/apps/laravel/htdocs/storage /opt/bitnami/apps/laravel/htdocs/bootstrap/cache
   sudo chmod -R 775 /opt/bitnami/apps/laravel/htdocs/storage /opt/bitnami/apps/laravel/htdocs/bootstrap/cache
   ```

---

## â‘¡ ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³ã®å–å¾—ã¨ Lightsailãƒ»ãŠåå‰ãƒ‰ãƒƒãƒˆã‚³ãƒ ã§ã®è¨­å®š

### 1. ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—

* ãŠåå‰ãƒ‰ãƒƒãƒˆã‚³ãƒ ãªã©ã§è³¼å…¥ã€‚
* ä¾‹: `safetimecard.com`

### 2. Lightsail å´è¨­å®š

1. Lightsail ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ **é™çš„ IP** ã‚’å–å¾—

   * â­ Elastic IP ã®ã‚ˆã†ã«å›ºå®š IP ã‚’è¨­å®šã—ã¦ãŠãã¨ä¾¿åˆ©

2. Lightsail ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«é™çš„ IP ã‚’ç´ã¥ã‘

### 3. DNS è¨­å®šï¼ˆãŠåå‰ãƒ‰ãƒƒãƒˆã‚³ãƒ ï¼‰

1. ãƒ‰ãƒ¡ã‚¤ãƒ³ç®¡ç†ç”»é¢ã§ **DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®š**

   * A ãƒ¬ã‚³ãƒ¼ãƒ‰: `www` â†’ Lightsail ã®é™çš„ IP
   * A ãƒ¬ã‚³ãƒ¼ãƒ‰: `@`ï¼ˆãƒ«ãƒ¼ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰ â†’ åŒã˜ IP

2. è¨­å®šå¾Œã€åæ˜ ã«æœ€å¤§ 24 æ™‚é–“ã‹ã‹ã‚‹ã“ã¨ã‚‚ã‚ã‚‹

---

## â‘¢ SSL åŒ–ï¼ˆLetâ€™s Encrypt + Bitnami bncertï¼‰

### 1. bncert ãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡Œ

```bash
sudo /opt/bitnami/bncert-tool
```

* ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ï¼ˆä¾‹: `safetimecard.com www.safetimecard.com`ï¼‰
* ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›
* åˆ©ç”¨è¦ç´„ã«åŒæ„
* è‡ªå‹•ã§ SSL è¨¼æ˜æ›¸å–å¾— + Apache è¨­å®š

### 2. Apache è¨­å®šã®ãƒã‚¤ãƒ³ãƒˆ

* `bitnami.conf` ã® DocumentRoot ã¯ **Laravel ã® public ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª** ã«

  ```apache
  DocumentRoot "/opt/bitnami/apps/laravel/htdocs/public"  # â­
  <Directory "/opt/bitnami/apps/laravel/htdocs/public">  
      Options Indexes FollowSymLinks
      AllowOverride All
      Require all granted
  </Directory>
  ```
* SSL è¨¼æ˜æ›¸ãƒ‘ã‚¹ã‚’ bncert è‡ªå‹•ç”Ÿæˆã®ã‚‚ã®ã«å¤‰æ›´

  ```apache
  SSLCertificateFile "/opt/bitnami/letsencrypt/certificates/www.safetimecard.com.crt"  # â­
  SSLCertificateKeyFile "/opt/bitnami/letsencrypt/certificates/www.safetimecard.com.key"
  SSLCertificateChainFile "/opt/bitnami/letsencrypt/certificates/www.safetimecard.com.crt"
  ```

### 3. Apache å†èµ·å‹•

```bash
sudo /opt/bitnami/ctlscript.sh restart apache
```

* â­ è¨­å®šå¾Œã«å¿…ãšæ§‹æ–‡ãƒã‚§ãƒƒã‚¯

  ```bash
  sudo /opt/bitnami/apache2/bin/apachectl -t
  ```

---

## â‘£ HTTP â†’ HTTPS ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ & www ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

* HTTP â†’ HTTPS

  ```apache
  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteCond %{REQUEST_URI} !^/\.well-known
  RewriteRule ^/(.*) https://%{SERVER_NAME}/$1 [R,L]
  ```
* é www â†’ www

  ```apache
  RewriteCond %{HTTP_HOST} !^www\. [NC]
  RewriteCond %{REQUEST_URI} !^/\.well-known
  RewriteRule ^(.*)$ https://www.%{HTTP_HOST}%{REQUEST_URI} [R=permanent,L]
  ```

---

ğŸ’¡ **æ³¨æ„ç‚¹**

1. Apache ãŒèµ·å‹•ã—ãªã„å ´åˆã¯ `apachectl -t` ã§åŸå› ã‚’ç¢ºèª
2. SSL è¨¼æ˜æ›¸ã®ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»ãƒ‘ã‚¹ã¯æ­£ç¢ºã«
3. Laravel ã® `.env` ã¯å…¬é–‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå¤–ã«ç½®ã
4. Lightsail ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã§ HTTP/HTTPS ãƒãƒ¼ãƒˆ 80/443 ã‚’é–‹æ”¾

---

ã‚‚ã—å¸Œæœ›ãªã‚‰ã€ã“ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã‚’ **PDF å½¢å¼ã«æ•´å½¢ã—ã¦å›³å…¥ã‚Šã§ã¾ã¨ã‚ã‚‹**ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

ä½œã‚Šã¾ã™ã‹ï¼Ÿ



